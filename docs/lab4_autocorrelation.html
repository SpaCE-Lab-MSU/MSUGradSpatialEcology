<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Phoebe Zarnetske; plz@msu.edu" />


<title>MSU Graduate Spatial Ecology Lab 4</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">MSU Grad Spatial Ecology</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="lab1_R.html">Lab 1</a>
</li>
<li>
  <a href="lab2_scale.html">Lab 2</a>
</li>
<li>
  <a href="lab3_patch_design.html">Lab 3</a>
</li>
<li>
  <a href="lab4_autocorrelation.html">Lab 4</a>
</li>
<li>
  <a href="lab5_variograms.html">Lab 5</a>
</li>
<li>
  <a href="lab6_interp_connect.html">Lab 6</a>
</li>
<li>
  <a href="lab7_opendata.html">Lab 7</a>
</li>
<li>
  <a href="lab8_sdm1.html">Lab 8</a>
</li>
<li>
  <a href="lab9_sdm2.html">Lab 9</a>
</li>
<li>
  <a href="lab10_sdm3.html">Lab 10</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">MSU Graduate Spatial Ecology Lab 4</h1>
<h4 class="author">Phoebe Zarnetske; <a href="mailto:plz@msu.edu"
class="email">plz@msu.edu</a></h4>
<h4 class="date">Sep 2015; rev. Sep 24, 2019, Sep 23-27, 2020, Sep 27,
2022</h4>

</div>


<div id="lab-4-spatial-autocorrelation-morans-i-mantel-test"
class="section level1">
<h1>Lab 4: Spatial Autocorrelation (Moran’s I, Mantel Test)</h1>
<p><em><a href="lab4_autocorrelation.Rmd">RMarkdown version of this
Lab</a></em></p>
<p>This lab has 2 Parts. You need to hand in Part 2 as a PDF produced
from R Markdown, including output plots, statistics, code, and text for
answers to the questions below. When referring to the code below it may
be more useful to use the .Rmd file linked above. OPTIONAL: If you would
like to test out GitHub in completing this lab, complete your .Rmd file
in RStudio and push your PDF (and your .Rmd if you want) to a
repository. You can add the link to the GitHub file when you submit to
D2L. Please also submit your PDF to D2L.</p>
<p>This lab uses the the brycesite environmental data from the R package
labdsv.</p>
<p>The variable list for the site variables is here: <a
href="https://www.rdocumentation.org/packages/labdsv/versions/2.0-1/topics/brycesite"
class="uri">https://www.rdocumentation.org/packages/labdsv/versions/2.0-1/topics/brycesite</a>.
A few notes: east=easting; north=northing; elev is recorded in feet; we
will convert to metric.</p>
<p>These data come from a vegetation survey in Bryce Canyon National
Park, Utah. It’s an amazing place with unique formations! For more about
Bryce Canyon see: <a href="https://www.nps.gov/brca/index.htm"
class="uri">https://www.nps.gov/brca/index.htm</a></p>
<center>
<img src="https://upload.wikimedia.org/wikipedia/commons/4/4d/USA_10654_Bryce_Canyon_Luca_Galuzzi_2007.jpg">
</center>
<p><a
href="https://upload.wikimedia.org/wikipedia/commons/4/4d/USA_10654_Bryce_Canyon_Luca_Galuzzi_2007.jpg"
class="uri">https://upload.wikimedia.org/wikipedia/commons/4/4d/USA_10654_Bryce_Canyon_Luca_Galuzzi_2007.jpg</a></p>
</div>
<div id="part-1-more-practice-plotting-spatial-data"
class="section level1">
<h1>Part 1: More practice plotting spatial data</h1>
<p><em>Start working in R:</em></p>
<pre class="r"><code>##### STARTING UP R
# Clear all existing data (or don&#39;t and just make sure you start with a newly opened RStudio session; see why this may not be so great for reproducibility: https://rstats.wtf/save-source.html#rm-list-ls)
rm(list=ls()) 

# Close graphics devices
graphics.off()

# Set the paths for your work
output_path&lt;-(&quot;output&quot;)
# if this folder doesn&#39;t exist, create it
if(!dir.exists(output_path)){
  dir.create(output_path)
}

# Create the folders (directories) &quot;data&quot; and &quot;lab4&quot; - If they exist already, this command won&#39;t over-write them.
data_path&lt;-(file.path(&quot;data&quot;,&quot;lab4&quot;))
if(!dir.exists(data_path)){
  dir.create(data_path,recursive = TRUE)
}</code></pre>
<p>If you previously saved your workspace and want to load it here, do
so this way:</p>
<p><code>load(file.path(output_path,"lab4.RData"))</code></p>
<p><strong>NOTES on R packages used in this lab:</strong></p>
<ol style="list-style-type: decimal">
<li>With R Markdown, it is helpful to install packages locally before
knitting. Load the packages:</li>
</ol>
<pre class="r"><code>library(sf)
library(tidyverse) 
library(ggplot2)
library(tmap)
library(ape)
library(ncf)
library(labdsv)
library(FedData)
library(ggspatial)
library(ggmap)
library(gt)
library(broom)
library(raster)

# Apply ggplot2 theme to remove gray background and set the base font size as 14. See:  https://ggplot2.tidyverse.org/reference/ggtheme.html for more theme options.
theme_set(theme_classic(base_size = 14))

# Call the data directly because it&#39;s loaded in the labdsv R package
data(brycesite)

# Plot the data in space, by elevation (brycesite has northing and easting so it&#39;s projection is UTM). Here we will use the sf R package.
head(brycesite)
site &lt;- brycesite %&gt;%
  drop_na(east, north) %&gt;% # drop missing locations
  mutate(elev_m = elev * 0.3048) # create new column; convert feet to meters

st_crs(site) # CRS for site doesn&#39;t exist because it&#39;s a dataframe (not spatial feature)

# Define CRS using the sf package
crs.geo &lt;- st_crs(&quot;+proj=utm +zone=12 +datum=WGS84&quot;)

# Make site into a spatial feature using sf package; assign its projection
site &lt;- site %&gt;%    
  st_as_sf(coords = c(&quot;east&quot;, &quot;north&quot;),
crs = crs.geo)

# Plot it with ggplot
site %&gt;%
  ggplot(aes(color = elev_m)) + geom_sf() +   
  scale_color_viridis_c(option = &quot;viridis&quot;,
                        name = &quot;Elevation (meters)&quot;)</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code># Plot it with tmap
# tmap
tm_shape(site) + tm_bubbles(palette = &quot;viridis&quot;,
             col = &quot;elev_m&quot;,
             size = 0.25)</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<pre class="r"><code># Take a look at the underlying elevation from the National Elevation Dataset (NED) using the FedData R package. The FedData package works best if you use a spatial object created with the sp package.
site.sp&lt;- as(site, &quot;Spatial&quot;)

# Returns a raster
NED &lt;- get_ned(
  template = site.sp,
  label = &quot;bryce&quot;
)

# If you have trouble with FedData package, the Lab4_NED data are on D2L in Lab 4&#39;s section as &quot;Lab4_NED.RData&quot;. Simply save it, and open it in R.</code></pre>
<p><em>Plot the elevation raster and the vegetation data plot locations
on the same map. Practice using ggplot2 for this plotting.</em> First,
project the raster to the veg data projection so we can plot them
together (you could instead project the veg data shapefile (which is
vector data) with the raster CRS, and you should project vector rather
than the raster if you plan on doing any spatial analysis with them
both). We’re just plotting so it’s ok.</p>
<pre class="r"><code>raster::crs(NED)
# Define crs using the raster pacakge
crs.geo.r &lt;- CRS(&quot;+proj=utm +zone=12 +datum=WGS84&quot;) # set CRS

NED &lt;- projectRaster(NED, crs = crs.geo.r)

# Create a dataframe out of the NED raster. This is a necessary step for plotting rasters with ggplot2. 
NED_df1 = as.data.frame(NED, xy = TRUE)
head(NED_df1)
NED_df1 &lt;- NED_df1 %&gt;%
  drop_na()
# Rename the elevation column
NED_df &lt;- NED_df1 %&gt;%
  rename(elev_NED = layer)
# Plot the NED with the points overlaid using ggplot. See how the elevation in the points aligns with the NED
NED_elev&lt;-ggplot() +
  geom_raster(data = NED_df, 
  aes(x = x, y = y, fill = elev_NED)) # x and y are defined as the column names, &quot;x&quot; and &quot;y&quot;; &quot;elev_NED&quot; is the elevation column

# Now add on the vegetation plots and their associated elevation from the elevdat data, and change the color of the raster.
NED_elev &lt;- ggplot() +
  geom_raster(data = NED_df, aes(x = x, y = y, fill = elev_NED)) + 
  geom_sf(data = site, aes(color = elev_m)) + 
  scale_fill_viridis_c(option = &quot;viridis&quot;,
    name = &quot;NED Elevation (m)&quot;) + 
    scale_color_viridis_c(option = &quot;plasma&quot;,
                         # direction = -1,
    name = &quot;Plot Elevation (m)&quot;) + 
  annotation_scale(location = &quot;br&quot;,
    width_hint = 0.5) + 
  annotation_north_arrow(location = &quot;br&quot;,
    which_north = &quot;true&quot;,
    pad_x = unit(0.75, &quot;in&quot;),
    pad_y = unit(0.5, &quot;in&quot;),
    style = north_arrow_orienteering) +
labs(title = &quot;Bryce Canyon Vegetation Plot Elevation&quot;) + 
  ylab(&quot;Latitude&quot;) +
  xlab(&quot;Longitude&quot;)
NED_elev</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code># Plot with tmap:
tm_shape(NED) +
tm_raster(alpha = 0.75, legend.show = FALSE) +
tm_shape(site) + tm_bubbles(palette = &quot;viridis&quot;,
               col = &quot;elev_m&quot;,
               size = 0.25)</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<p><em>Or you could use <code>ggmap</code> to pull in a terrain map and
overlay the plots on top.</em> This ggmap uses Lat Lon, which isn’t as
ideal for inter-point distances. It’s better to stick with analysis
using the UTM meters. But this ggmap can make some nice maps. It also
has terrain options, roads, etc.</p>
<pre class="r"><code>?get_stamenmap # see the details on the commands 

bc_map &lt;- get_stamenmap(bbox = c(left = -112.5, bottom = 37.25, 
                                  right = -111.9, top = 37.8), 
                         zoom = 10)
ggmap(bc_map)</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>OPTIONAL: see if you can overlay the elevation plots on this ggmap
terrain map.</p>
</div>
<div id="part-2-morans-i-and-mantel-test" class="section level1">
<h1>Part 2: Moran’s I and Mantel test</h1>
<div id="morans-i-in-package-ape" class="section level2">
<h2>Moran’s I in package <code>ape</code></h2>
<p>Check assumptions about the elevation data; an assumption of the
Moran’s I test is that data are normally distributed. Determine whether
data should be transformed. Some transformations to consider:
square-root, log.</p>
<pre class="r"><code>hist(site$elev)</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>shapiro.test(site$elev)</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  site$elev
## W = 0.95485, p-value = 5.093e-05</code></pre>
<pre class="r"><code>qqnorm(site$elev)
qqline(site$elev,col=&quot;blue&quot;)</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-6-2.png" width="672" /></p>
<pre class="r"><code>shapiro.test(log(site$elev))</code></pre>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  log(site$elev)
## W = 0.94937, p-value = 1.689e-05</code></pre>
<pre class="r"><code>qqnorm(log(site$elev))
qqline(log(site$elev),col=&quot;red&quot;)</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-6-3.png" width="672" /></p>
<pre class="r"><code>site$log.elev &lt;- log(site$elev)

# Tidy up the output; use broom and gt packages
shap_test_elev &lt;- tidy(shapiro.test(site$elev_m)) 
shap_test_elev %&gt;%
  gt() %&gt;%
  tab_header(title = &quot;Shapiro Test (elevation)&quot;)</code></pre>
<div id="tngzvvxclw" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#tngzvvxclw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tngzvvxclw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tngzvvxclw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tngzvvxclw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tngzvvxclw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tngzvvxclw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tngzvvxclw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tngzvvxclw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tngzvvxclw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tngzvvxclw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tngzvvxclw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tngzvvxclw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#tngzvvxclw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tngzvvxclw .gt_from_md > :first-child {
  margin-top: 0;
}

#tngzvvxclw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tngzvvxclw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tngzvvxclw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#tngzvvxclw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#tngzvvxclw .gt_row_group_first td {
  border-top-width: 2px;
}

#tngzvvxclw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tngzvvxclw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#tngzvvxclw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#tngzvvxclw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tngzvvxclw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tngzvvxclw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tngzvvxclw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tngzvvxclw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tngzvvxclw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tngzvvxclw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tngzvvxclw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tngzvvxclw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tngzvvxclw .gt_left {
  text-align: left;
}

#tngzvvxclw .gt_center {
  text-align: center;
}

#tngzvvxclw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tngzvvxclw .gt_font_normal {
  font-weight: normal;
}

#tngzvvxclw .gt_font_bold {
  font-weight: bold;
}

#tngzvvxclw .gt_font_italic {
  font-style: italic;
}

#tngzvvxclw .gt_super {
  font-size: 65%;
}

#tngzvvxclw .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#tngzvvxclw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#tngzvvxclw .gt_indent_1 {
  text-indent: 5px;
}

#tngzvvxclw .gt_indent_2 {
  text-indent: 10px;
}

#tngzvvxclw .gt_indent_3 {
  text-indent: 15px;
}

#tngzvvxclw .gt_indent_4 {
  text-indent: 20px;
}

#tngzvvxclw .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <td colspan="3" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Shapiro Test (elevation)</td>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">statistic</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">p.value</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">method</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">0.9548468</td>
<td class="gt_row gt_right">5.092745e-05</td>
<td class="gt_row gt_left">Shapiro-Wilk normality test</td></tr>
  </tbody>
  
  
</table>
</div>
<pre class="r"><code>shap_test_lelev &lt;- tidy(shapiro.test(log(site$elev_m))) 
shap_test_lelev %&gt;%
  gt() %&gt;%
  tab_header(title = &quot;Shapiro Test (log elevation)&quot;)</code></pre>
<div id="vdtaxydbrr" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vdtaxydbrr .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vdtaxydbrr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vdtaxydbrr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vdtaxydbrr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vdtaxydbrr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vdtaxydbrr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vdtaxydbrr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vdtaxydbrr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vdtaxydbrr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vdtaxydbrr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vdtaxydbrr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vdtaxydbrr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vdtaxydbrr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vdtaxydbrr .gt_from_md > :first-child {
  margin-top: 0;
}

#vdtaxydbrr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vdtaxydbrr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vdtaxydbrr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vdtaxydbrr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vdtaxydbrr .gt_row_group_first td {
  border-top-width: 2px;
}

#vdtaxydbrr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vdtaxydbrr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vdtaxydbrr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vdtaxydbrr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vdtaxydbrr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vdtaxydbrr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vdtaxydbrr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vdtaxydbrr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vdtaxydbrr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vdtaxydbrr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vdtaxydbrr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vdtaxydbrr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vdtaxydbrr .gt_left {
  text-align: left;
}

#vdtaxydbrr .gt_center {
  text-align: center;
}

#vdtaxydbrr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vdtaxydbrr .gt_font_normal {
  font-weight: normal;
}

#vdtaxydbrr .gt_font_bold {
  font-weight: bold;
}

#vdtaxydbrr .gt_font_italic {
  font-style: italic;
}

#vdtaxydbrr .gt_super {
  font-size: 65%;
}

#vdtaxydbrr .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#vdtaxydbrr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vdtaxydbrr .gt_indent_1 {
  text-indent: 5px;
}

#vdtaxydbrr .gt_indent_2 {
  text-indent: 10px;
}

#vdtaxydbrr .gt_indent_3 {
  text-indent: 15px;
}

#vdtaxydbrr .gt_indent_4 {
  text-indent: 20px;
}

#vdtaxydbrr .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <td colspan="3" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Shapiro Test (log elevation)</td>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">statistic</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">p.value</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">method</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">0.9493736</td>
<td class="gt_row gt_right">1.689473e-05</td>
<td class="gt_row gt_left">Shapiro-Wilk normality test</td></tr>
  </tbody>
  
  
</table>
</div>
<pre class="r"><code># You can combine them into 1 table like this:
shap_test_df &lt;- data.frame(var = c(&quot;elev_m&quot;, &quot;log_elev&quot;),
  statistic = c(shap_test_elev$statistic, shap_test_lelev$statistic),
  p.value = c(shap_test_elev$p.value, shap_test_lelev$p.value)) 

shap_test_df %&gt;%
  slice(1:2) %&gt;%
  gt() %&gt;%
  tab_header(title = &quot;Shapiro Test Results&quot;)</code></pre>
<div id="xsrgrtbvhf" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xsrgrtbvhf .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xsrgrtbvhf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xsrgrtbvhf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xsrgrtbvhf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xsrgrtbvhf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xsrgrtbvhf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xsrgrtbvhf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xsrgrtbvhf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xsrgrtbvhf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xsrgrtbvhf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xsrgrtbvhf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xsrgrtbvhf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#xsrgrtbvhf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xsrgrtbvhf .gt_from_md > :first-child {
  margin-top: 0;
}

#xsrgrtbvhf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xsrgrtbvhf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xsrgrtbvhf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xsrgrtbvhf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xsrgrtbvhf .gt_row_group_first td {
  border-top-width: 2px;
}

#xsrgrtbvhf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xsrgrtbvhf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xsrgrtbvhf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xsrgrtbvhf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xsrgrtbvhf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xsrgrtbvhf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xsrgrtbvhf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xsrgrtbvhf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xsrgrtbvhf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xsrgrtbvhf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xsrgrtbvhf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xsrgrtbvhf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xsrgrtbvhf .gt_left {
  text-align: left;
}

#xsrgrtbvhf .gt_center {
  text-align: center;
}

#xsrgrtbvhf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xsrgrtbvhf .gt_font_normal {
  font-weight: normal;
}

#xsrgrtbvhf .gt_font_bold {
  font-weight: bold;
}

#xsrgrtbvhf .gt_font_italic {
  font-style: italic;
}

#xsrgrtbvhf .gt_super {
  font-size: 65%;
}

#xsrgrtbvhf .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#xsrgrtbvhf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xsrgrtbvhf .gt_indent_1 {
  text-indent: 5px;
}

#xsrgrtbvhf .gt_indent_2 {
  text-indent: 10px;
}

#xsrgrtbvhf .gt_indent_3 {
  text-indent: 15px;
}

#xsrgrtbvhf .gt_indent_4 {
  text-indent: 20px;
}

#xsrgrtbvhf .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <td colspan="3" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Shapiro Test Results</td>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col">var</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">statistic</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col">p.value</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">elev_m</td>
<td class="gt_row gt_right">0.9548468</td>
<td class="gt_row gt_right">5.092745e-05</td></tr>
    <tr><td class="gt_row gt_left">log_elev</td>
<td class="gt_row gt_right">0.9493736</td>
<td class="gt_row gt_right">1.689473e-05</td></tr>
  </tbody>
  
  
</table>
</div>
<pre class="r"><code># add easting and northing column to site_sf object
site_coords &lt;- site %&gt;% 
  st_coordinates() %&gt;% 
  as.data.frame()
site &lt;- site_coords %&gt;% 
  bind_cols(site) %&gt;% 
  rename(east = X, north = Y)

# Compute distance matrix
data.dist &lt;- as.matrix(dist(cbind(site$east,site$north)))

# Check the maximum distance within the site (units = meters)
max(data.dist)</code></pre>
<pre><code>## [1] 31583.48</code></pre>
<pre class="r"><code># Create an inverse distance matrix
w &lt;- 1/data.dist
diag(w) &lt;- 0

# Histogram breaks &amp; counts
hist(data.dist)$breaks</code></pre>
<pre><code>##  [1]     0  2000  4000  6000  8000 10000 12000 14000 16000 18000 20000 22000
## [13] 24000 26000 28000 30000 32000</code></pre>
<pre class="r"><code>hist(data.dist)$counts</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-6-4.png" width="672" /></p>
<pre><code>##  [1] 2303 2406 2674 3262 2710 2698 2874 1968 1260  762  644  606  512  432  146
## [16]   24</code></pre>
<pre class="r"><code># Plot the distance matrix with one option of Distance classes
# (note: these may not be the most informative classes)
hist(data.dist,
     main=&quot;Histogram of distances with classes chosen&quot;,
     xlab=&quot;Distance (meters)&quot;,
     col=&quot;gray&quot;,
     ylim=c(0,4500))
abline(v=c(0,4000,8000,12000,16000,20000,24000,28000),
       col=&quot;purple&quot;,
       lwd=2)</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-6-5.png" width="672" /></p>
<pre class="r"><code>#Compute Moran&#39;s I
Moran.I(site$log.elev, w, scaled = T, na.rm = T, alternative = &quot;two.sided&quot;)</code></pre>
<pre><code>## $observed
## [1] 0.5036994
## 
## $expected
## [1] -0.006329114
## 
## $sd
## [1] 0.01934851
## 
## $p.value
## [1] 0</code></pre>
<pre class="r"><code>Moran.I(site$elev, w, scaled = T, na.rm = T, alternative = &quot;two.sided&quot;)</code></pre>
<pre><code>## $observed
## [1] 0.5048929
## 
## $expected
## [1] -0.006329114
## 
## $sd
## [1] 0.0193532
## 
## $p.value
## [1] 0</code></pre>
<div id="question-1" class="section level3">
<h3>QUESTION 1:</h3>
<p>Interpret Moran’s I results. Is there a more appropriate form of
elevation data (transformed or non-transformed) for this test?</p>
<p>Next, create a Correlogam for Elevation using <code>correlog</code>
using a specific increment for distance classes (here shown with 1000m
increments; use a different distance class in your example).</p>
<pre class="r"><code>cor.elev &lt;- correlog(site$east, site$north, site$elev, increment = 1000, resamp = 100)
plot(cor.elev, col = &quot;blue&quot;)
abline(h = 0, col = &quot;purple&quot;)</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code>cor.lelev &lt;- correlog(site$east, site$north, site$log.elev, increment = 1000, resamp = 100)
plot(cor.lelev, col = &quot;red&quot;)
abline(h = 0, col = &quot;purple&quot;)</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<pre class="r"><code>fit &lt;- invisible(correlog(x = site$east, y = site$north, z = site$elev, resamp = 100, increment = 1000))
#How many classes are significant by alpha = 0.05?
length(which(fit$p &lt;= 0.05)) 

plot(fit$mean.of.class, fit$correlation, pch = 19, &quot;black&quot;, ylab = &quot;Correlation coefficient&quot;, xlab = &quot;Distance (mean of class)&quot;, main = &quot;Correlogram for elevation change&quot;)</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-7-3.png" width="672" /></p>
<pre class="r"><code># You can also try other R packages like pgirmess, to make correlograms (note that the function has the same name &quot;correlog&quot; in both R packages; you need to specify which one to use).
pgi.cor &lt;- pgirmess::correlog(coords=site_coords, z=site$elev, method=&quot;Moran&quot;, nbclass=20)
plot(pgi.cor)</code></pre>
<p><img src="lab4_autocorrelation_files/figure-html/unnamed-chunk-7-4.png" width="672" /></p>
</div>
<div id="question-2" class="section level3">
<h3>QUESTION 2:</h3>
<p>Plot and interpret your correlograms. Explain your choice of Distance
Classes.</p>
</div>
<div id="question-3" class="section level3">
<h3>QUESTION 3:</h3>
<p>Perform a statistical test to determine if your peaks are
significant. Hint: look at your <code>correlog</code> output. Which ones
are significant?</p>
</div>
</div>
<div id="mantel-test" class="section level2">
<h2>Mantel Test</h2>
<p>Now use the Mantel test to compare differences in elevation at
specified points to the distance between those points. This will help
you determine whether plots that are closer together have more similar
elevations, and if plots that are farther apart have more dissimilar
elevations. In this case we’re treating the space between sampling
locations (their geography) as the predictor variable which is
predicting the elevation values.</p>
<pre class="r"><code># We already have the euclidean distance matrix (data.dist)
# Compute the distance between elevation measurements
elev.dist &lt;- as.matrix(dist(cbind(site$elev, site$elev)))

# Run a Mantel test on the two matrices
mant.results &lt;- ape::mantel.test(m1 = data.dist, m2 = elev.dist, nperm = 999, alternative = &#39;two.sided&#39;)</code></pre>
<p>Next, choose a NEW VARIABLE from the <code>brycesite</code>
dataframe. Plot the variable in space (see the code for plotting
elevation on a map, above). The variable list for the site variables is
here: <a
href="https://www.rdocumentation.org/packages/labdsv/versions/2.0-1/topics/brycesite"
class="uri">https://www.rdocumentation.org/packages/labdsv/versions/2.0-1/topics/brycesite</a>.</p>
<div id="question-4" class="section level3">
<h3>QUESTION 4:</h3>
<p>What are the general patterns of the NEW VARIABLE across space? Do
you expect your NEW VARIABLE to be spatially correlated with elevation
across the study region? Why or why not?</p>
</div>
<div id="question-5" class="section level3">
<h3>QUESTION 5:</h3>
<p>Run a Mantel test to look at correlations between the matrices of the
two variables (a Mantel test between your NEW VARIABLE distance matrix
and <code>elev.dist</code>).</p>
<p>You will need to create your <code>NEWVARIABLE.dist</code> like
this:</p>
<p><code>NEWVARIABLE.dist &lt;- as.matrix(dist(cbind(site$NEWVARIABLE, site$NEWVARIABLE)))</code></p>
<p>Interpret the results of the Mantel tests relative to your
predictions from Question 4. You may want to run <code>correlog()</code>
on your NEW VARIABLE to help with interpretation.</p>
<p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This
work is licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Licensed
under CC-BY 4.0 2020; 2022 by Phoebe Zarnetske. Special thanks to Nan
Nourn for updates related to sf, tmap, gt R packages</a>.</p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
