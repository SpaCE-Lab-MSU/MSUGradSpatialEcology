<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Phoebe Zarnetske; plz@msu.edu" />


<title>MSU Graduate Spatial Ecology Lab 2</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">MSU Grad Spatial Ecology</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="lab1_R.html">Lab 1</a>
</li>
<li>
  <a href="lab2_scale.html">Lab 2</a>
</li>
<li>
  <a href="lab3_patch_design.html">Lab 3</a>
</li>
<li>
  <a href="lab4_autocorrelation.html">Lab 4</a>
</li>
<li>
  <a href="lab5_variograms.html">Lab 5</a>
</li>
<li>
  <a href="lab6_interp_connect.html">Lab 6</a>
</li>
<li>
  <a href="lab7_opendata.html">Lab 7</a>
</li>
<li>
  <a href="lab8_sdm1.html">Lab 8</a>
</li>
<li>
  <a href="lab9_sdm2.html">Lab 9</a>
</li>
<li>
  <a href="lab10_sdm3.html">Lab 10</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">MSU Graduate Spatial Ecology Lab 2</h1>
<h4 class="author">Phoebe Zarnetske; <a href="mailto:plz@msu.edu"
class="email">plz@msu.edu</a></h4>
<h4 class="date">Sep 2016; rev. Sep 9, 2019, Aug 18-Sep 10, 2020, Sep
12, 2022</h4>

</div>


<div id="lab-2-r-markdown-intro-to-mapping-in-r-scale"
class="section level1">
<h1>Lab 2: R Markdown, Intro to mapping in R &amp; Scale</h1>
<p><em><a href="lab2_scale.Rmd">RMarkdown version of this
Lab</a></em></p>
<p>This lab has 2 Parts. You need to hand in Part 2 via the D2L Lab 2
Assignment Folder by start of Lab 3. When referring to the code below it
may be more useful to use the .Rmd file linked above. You will need to
be connected to the internet to complete this lab.</p>
<p>At the end of Lab 2 is Homework in preparation for Lab 3.</p>
<div id="part-1-r-markdown" class="section level2">
<h2>Part 1: R Markdown</h2>
<p>R Markdown is an authoring framework for R code and output. R
Markdown is part word-processor, part R output. It enables you to
generate nice reports with R code, figures, tables, and text. It’s handy
because it produces neat summaries of your work in HTML or PDF or other
formats (Word docs). This document was made in Markdown via RStudio.
From now on, you’ll be handing in all of your lab assignments as PDFs
produced from R Markdown.</p>
<p>R Markdown is especially helpful with collaborative research and
coursework, and is often used in supplemental materials with
publications. If you haven’t already watched the R Markdown tutorial,
you may want to refer to it when putting together your lab write-up: <a
href="http://rmarkdown.rstudio.com/lesson-1.html"
class="uri">http://rmarkdown.rstudio.com/lesson-1.html</a> (including
“How it Works”, “Code Chunks”, and “Markdown Basics”). I recommend using
“KnitR” in RStudio when you want to publish (i.e., click on “knit to
HTML”, “knit to PDF”, etc. in the pull-down menu in RStudio).</p>
<p>When you click the <strong>Knit</strong> button in R Studio (looks
like a knitting needle with ball of yarn) a document will be generated
that includes both content as well as the output of any embedded R code
chunks within the document.</p>
<div id="help-with-knitting-to-pdf" class="section level3">
<h3>Help with knitting to PDF</h3>
<p>You may need to install a TEX program to knit to PDF. Try knitting
first to PDF, if this doesn’t work here is a suggestion (this may take a
while to download):</p>
<p>For Mac: MacTex: <a href="http://www.tug.org/mactex/"
class="uri">http://www.tug.org/mactex/</a> For PC: MikTex: <a
href="http://www.miktex.org/2.9/setup"
class="uri">http://www.miktex.org/2.9/setup</a> some details on setting
up with MikTex: <a href="https://latex.org/forum/viewtopic.php?t=7999"
class="uri">https://latex.org/forum/viewtopic.php?t=7999</a></p>
<p>If you have trouble knitting to PDF directly in RStudio, you can also
save to HTML and when you open the HTML in a browser, you can “save as
PDF” or “print to PDF” directly from the browser. Just make sure what
you end up handing in originated as a .Rmd file and presents the code
and plots and lab writeup clearly - if it renders in HTML well, then you
can hand HTML in (Note that D2L does not render HTML well inside D2L; as
long as it works in a browser, it should be ok).</p>
</div>
<div id="interested-in-more-detail-on-how-to-use-rmarkdown-and-knitr"
class="section level3">
<h3>Interested in more detail on how to use RMarkdown and knitr?</h3>
<p>Here is a great mini tutorial from EarthLab illustrating how to get
started with RMarkdown in RStudio. Note that Lesson 2 is the intro to
RMarkdown &amp; Knitr: <a
href="https://www.earthdatascience.org/courses/earth-analytics/document-your-science/intro-to-the-rmarkdown-format-and-knitr/"
class="uri">https://www.earthdatascience.org/courses/earth-analytics/document-your-science/intro-to-the-rmarkdown-format-and-knitr/</a></p>
<p>EarthLab’s Lesson 5 goes over how to knit to PDF or HTML. <a
href="https://www.earthdatascience.org/courses/earth-analytics/document-your-science/knit-rmarkdown-document-to-pdf/"
class="uri">https://www.earthdatascience.org/courses/earth-analytics/document-your-science/knit-rmarkdown-document-to-pdf/</a></p>
</div>
<div id="some-basics-of-rmarkdown-are-included-below"
class="section level3">
<h3>Some basics of RMarkdown are included below:</h3>
<p>In RMarkdown, you can embed an R code chunk like this:</p>
<pre class="r"><code>summary(cars)</code></pre>
<pre><code>##      speed           dist       
##  Min.   : 4.0   Min.   :  2.00  
##  1st Qu.:12.0   1st Qu.: 26.00  
##  Median :15.0   Median : 36.00  
##  Mean   :15.4   Mean   : 42.98  
##  3rd Qu.:19.0   3rd Qu.: 56.00  
##  Max.   :25.0   Max.   :120.00</code></pre>
<pre class="r"><code>summary(cars)</code></pre>
<p><code>results = 'hide'</code> will omit the printout (suppressing the
summary of the dataframe cars) R Markdown can print or hide certain
portions of your code and output. This is helpful especially when you
don’t want to include long print-outs in a report. For lab assignments,
please don’t include long R printouts, e.g., printing an entire
dataset.</p>
</div>
<div id="including-plots" class="section level3">
<h3>Including Plots</h3>
<p>You can also embed plots, for example with the dataframe, pressure:
<img src="lab2_scale_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p><code>echo = FALSE</code> will not print the code beneath it; TRUE is
the default. You can also set a figure height and width in the brackets
also. Units = inches.</p>
<p><img src="lab2_scale_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p><code>warning = FALSE</code> will not print the R warnings beneath
it; TRUE is the default.</p>
</div>
</div>
<div id="part-2-intro-to-mapping-in-r-scale" class="section level2">
<h2>Part 2: Intro to mapping in R &amp; Scale</h2>
<p>R is ok for making maps - it’s getting better. If you want something
super pretty or very complicated, it is probably better to go with QGIS
(free) or ArcGIS (not free). However, you can make some nice maps in R
with some basic commands, and because it’s all scripted, it’s useful for
reproducible research.</p>
<pre class="r"><code>##### STARTING UP R
# Clear all existing data
rm(list=ls())

# Close graphics devices
graphics.off()

# Set the paths for your work
output_path&lt;-(&quot;output&quot;)
# if this folder doesn&#39;t exist, create it
if(!dir.exists(output_path)){
  dir.create(output_path)
}


# Create the folders (directories) &quot;data&quot; and &quot;lab2&quot; - If they exist already, this 
# command won&#39;t over-write them.
data_path&lt;-(file.path(&quot;data&quot;,&quot;lab2&quot;))
if(!dir.exists(data_path)){
  dir.create(data_path,recursive = TRUE)
}

# If you previously saved your workspace and want to load it here, do so this way 
# load(file.path(output_path,&quot;lab2.RData&quot;))
     
# With R Markdown, it is helpful to install packages locally before knitting (copy this into your R console before you knit)
for (package in c(&quot;raster&quot;,&quot;sp&quot;,&quot;rgdal&quot;,&quot;dismo&quot;)) {
  if (!require(package, character.only=T, quietly=T)) {
    install.packages(package)
    library(package, character.only=T)
  }
}

# Don&#39;t worry about rgdal warning; it works. It has to do with the eventual switch to other packages that depend on rgdal.

# If you get a warning that says: there is no package called &#39;raster&#39; (or another package) type into your R console: 
# package(raster)
# library(raster)

# If you haven&#39;t updated your packages in a while, see if any need updating.
# In RStudio: Tools: Check for Package Updates.</code></pre>
<div id="coordinate-reference-systems-projection"
class="section level3">
<h3>Coordinate Reference Systems &amp; Projection</h3>
<p>Check out this helpful (and fun) video that explains projections and
CRS: <a href="https://ed.ted.com/featured/uTE96JbJ"
class="uri">https://ed.ted.com/featured/uTE96JbJ</a> To see why every
map we view is relative, check out this interactive site: <a
href="https://thetruesize.com/"
class="uri">https://thetruesize.com/</a></p>
<p>Download and read in some spatial data. Spatial data require spatial
reference. A common way of defining the spatial reference is with:</p>
<p><em>proj4</em> = projection information about the spatial data,
and</p>
<p><em>CRS</em> = coordinate reference systems containing projection,
datum, and ellipsoid.</p>
<p>A CRS provides the key for how to interpret spatially referenced data
given a specific geometry. It provides information about how to
transform a three dimensional angular system into a 2-dimensional planar
system. Great overview: <a
href="https://www.nceas.ucsb.edu/~frazier/RSpatialGuides/OverviewCoordinateReferenceSystems.pdf"
class="uri">https://www.nceas.ucsb.edu/~frazier/RSpatialGuides/OverviewCoordinateReferenceSystems.pdf</a>
for the proj4 strings see www.spatialreference.org or search on <a
href="https://epsg.io/" class="uri">https://epsg.io/</a></p>
<pre class="r"><code># USA BOUNDARY SHAPEFILE from the US Census Bureau (https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html);  download it from the web [note that you may need to change the exdir location depending on where you want it to be saved]
if(! file.exists(file.path(data_path,&#39;us.zip&#39;))){
 download.file(&quot;https://www2.census.gov/geo/tiger/GENZ2021/shp/cb_2021_us_nation_20m.zip&quot;, dest=file.path(data_path,&quot;us.zip&quot;), mode=&quot;wb&quot;) 
}

unzip (file.path(data_path,&quot;us.zip&quot;), exdir = data_path)
# Read in the shapefile with rgdal package
us &lt;- readOGR(file.path(data_path,&quot;cb_2021_us_nation_20m.shp&quot;))
# Note that shapefiles are actually a collection of many files. If you move a shapefile manually, be sure to copy all of the files.

# take a look at the shapefile info
summary(us)</code></pre>
<p>Uh oh! It’s not projected, is that a problem? The proj4string states
that it’s a geographic coordinate system (rather than a projected
coordinate system).</p>
<p>All Census Bureau generated shapefiles are in Global Coordinate
System North American Datum of 1983 (GCS NAD83). Each .prj file contains
the following:
GEOGCS[“GCS_North_American_1983”,DATUM[“D_North_American_1983”,SPHEROID[“GRS_1980”,6378137,
298.257222101]],PRIMEM[“Greenwich”,0],UNIT[“Degree”,0.017453292519943295]]</p>
<p>So in this case the CRS is a geographic coordinate system (rather
than a projected coordinate system). Geographic systems include angular
unit of measure, a prime meridian, and a datum (based on a spheroid).
Latitude and Longitude describe any location in geographic coordinate
system, in unites of degrees. If we wanted to do some exact measurements
of distances or areas, it would be better to use a projection. This is
because projections transform a 3D surface (Earth; a sphere) into a 2D
surface and maintain constant lengths and angles, preserving area.
Geographic systems have different lengths and and angles depending on
the location within the spatial data. Google Maps uses a Web Mercator
projection (flat Earth): <a
href="https://en.wikipedia.org/wiki/Web_Mercator_projection"
class="uri">https://en.wikipedia.org/wiki/Web_Mercator_projection</a>.</p>
</div>
<div id="projecting-data" class="section level3">
<h3>Projecting Data</h3>
<pre class="r"><code>## This defines the CRS for the US National Atlas Map Projection
us.atlas.proj &lt;- CRS(&quot;+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs&quot;)
# set a plotting area for 2 side-by-side subplots
par(mfcol=c(1,2)) 
# plot the shapefile in the first subplot 
plot(us)
# project to US National Atlas equal-area projection
us.equal &lt;- spTransform(us, us.atlas.proj)
# plot the other shapefile in the second subplot
plot(us.equal)</code></pre>
<p><img src="lab2_scale_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div
id="reading-in-data-from-gbif.org---the-global-biodiversity-information-facility"
class="section level3">
<h3>Reading in data from gbif.org - the Global Biodiversity Information
Facility</h3>
<p>Add some point data for a species from GBIF.org. Get GBIF data with
function gbif() from the <em>dismo</em> R package or choose your own
favorite organism (in the US). Check the GBIF site first to see how many
occurrences you’ll be importing <a
href="http://www.gbif.org/occurrence/search"
class="uri">http://www.gbif.org/occurrence/search</a> - enter your
species name in the search window. Click on “filter” and scientific
name. Puma concolor has 17000+ records, and may take a few mins to
import. Choose a different species in the US with a smaller number if
you don’t want to wait so long (but it’s only a few mins).</p>
<pre class="r"><code># Take a look at the command &quot;gbif&quot; to see what options exist for importing data.
?gbif
# Import the occurrence data on Puma concolor.
puma.gbif &lt;- gbif(&quot;Puma&quot;, &quot;concolor&quot;, geo=T) 
# plot occurrences
par(mfcol=c(1,1))
plot(us, main=&quot;Puma concolor observations&quot;)
points(puma.gbif$lon, puma.gbif$lat,
       pch=19, cex=0.3, col=&quot;blue&quot;)</code></pre>
<p><img src="lab2_scale_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code># important: longitude goes first and hence the order
# lat=column 114; lon=column 127
names(puma.gbif) </code></pre>
<pre><code>##   [1] &quot;acceptedNameUsage&quot;                        
##   [2] &quot;acceptedScientificName&quot;                   
##   [3] &quot;acceptedTaxonKey&quot;                         
##   [4] &quot;accessRights&quot;                             
##   [5] &quot;adm1&quot;                                     
##   [6] &quot;adm2&quot;                                     
##   [7] &quot;associatedOccurrences&quot;                    
##   [8] &quot;associatedReferences&quot;                     
##   [9] &quot;associatedSequences&quot;                      
##  [10] &quot;basisOfRecord&quot;                            
##  [11] &quot;bed&quot;                                      
##  [12] &quot;behavior&quot;                                 
##  [13] &quot;bibliographicCitation&quot;                    
##  [14] &quot;catalogNumber&quot;                            
##  [15] &quot;class&quot;                                    
##  [16] &quot;classKey&quot;                                 
##  [17] &quot;cloc&quot;                                     
##  [18] &quot;collectionCode&quot;                           
##  [19] &quot;collectionID&quot;                             
##  [20] &quot;collectionKey&quot;                            
##  [21] &quot;continent&quot;                                
##  [22] &quot;coordinatePrecision&quot;                      
##  [23] &quot;coordinateUncertaintyInMeters&quot;            
##  [24] &quot;country&quot;                                  
##  [25] &quot;crawlId&quot;                                  
##  [26] &quot;dataGeneralizations&quot;                      
##  [27] &quot;datasetID&quot;                                
##  [28] &quot;datasetKey&quot;                               
##  [29] &quot;datasetName&quot;                              
##  [30] &quot;dateIdentified&quot;                           
##  [31] &quot;day&quot;                                      
##  [32] &quot;depth&quot;                                    
##  [33] &quot;depthAccuracy&quot;                            
##  [34] &quot;disposition&quot;                              
##  [35] &quot;dynamicProperties&quot;                        
##  [36] &quot;earliestAgeOrLowestStage&quot;                 
##  [37] &quot;earliestEonOrLowestEonothem&quot;              
##  [38] &quot;earliestEpochOrLowestSeries&quot;              
##  [39] &quot;earliestEraOrLowestErathem&quot;               
##  [40] &quot;earliestPeriodOrLowestSystem&quot;             
##  [41] &quot;elevation&quot;                                
##  [42] &quot;elevationAccuracy&quot;                        
##  [43] &quot;endDayOfYear&quot;                             
##  [44] &quot;establishmentMeans&quot;                       
##  [45] &quot;eventDate&quot;                                
##  [46] &quot;eventID&quot;                                  
##  [47] &quot;eventRemarks&quot;                             
##  [48] &quot;eventTime&quot;                                
##  [49] &quot;family&quot;                                   
##  [50] &quot;familyKey&quot;                                
##  [51] &quot;fieldNotes&quot;                               
##  [52] &quot;fieldNumber&quot;                              
##  [53] &quot;footprintSRS&quot;                             
##  [54] &quot;footprintWKT&quot;                             
##  [55] &quot;formation&quot;                                
##  [56] &quot;fullCountry&quot;                              
##  [57] &quot;gbifID&quot;                                   
##  [58] &quot;genericName&quot;                              
##  [59] &quot;genus&quot;                                    
##  [60] &quot;genusKey&quot;                                 
##  [61] &quot;geodeticDatum&quot;                            
##  [62] &quot;geologicalContextID&quot;                      
##  [63] &quot;georeferencedBy&quot;                          
##  [64] &quot;georeferencedDate&quot;                        
##  [65] &quot;georeferenceProtocol&quot;                     
##  [66] &quot;georeferenceRemarks&quot;                      
##  [67] &quot;georeferenceSources&quot;                      
##  [68] &quot;georeferenceVerificationStatus&quot;           
##  [69] &quot;group&quot;                                    
##  [70] &quot;habitat&quot;                                  
##  [71] &quot;higherClassification&quot;                     
##  [72] &quot;higherGeography&quot;                          
##  [73] &quot;higherGeographyID&quot;                        
##  [74] &quot;highestBiostratigraphicZone&quot;              
##  [75] &quot;hostingOrganizationKey&quot;                   
##  [76] &quot;http://unknown.org/basionymAuthors&quot;       
##  [77] &quot;http://unknown.org/basionymYear&quot;          
##  [78] &quot;http://unknown.org/canonicalName&quot;         
##  [79] &quot;http://unknown.org/captive&quot;               
##  [80] &quot;http://unknown.org/language&quot;              
##  [81] &quot;http://unknown.org/nick&quot;                  
##  [82] &quot;http://unknown.org/recordEnteredBy&quot;       
##  [83] &quot;http://unknown.org/recordId&quot;              
##  [84] &quot;http://unknown.org/recordID&quot;              
##  [85] &quot;http://unknown.org/rights&quot;                
##  [86] &quot;http://unknown.org/rightsHolder&quot;          
##  [87] &quot;http://unknown.org/verbatimScientificName&quot;
##  [88] &quot;identificationID&quot;                         
##  [89] &quot;identificationQualifier&quot;                  
##  [90] &quot;identificationReferences&quot;                 
##  [91] &quot;identificationRemarks&quot;                    
##  [92] &quot;identificationVerificationStatus&quot;         
##  [93] &quot;identifiedBy&quot;                             
##  [94] &quot;identifier&quot;                               
##  [95] &quot;individualCount&quot;                          
##  [96] &quot;informationWithheld&quot;                      
##  [97] &quot;infraspecificEpithet&quot;                     
##  [98] &quot;installationKey&quot;                          
##  [99] &quot;institutionCode&quot;                          
## [100] &quot;institutionID&quot;                            
## [101] &quot;institutionKey&quot;                           
## [102] &quot;isInCluster&quot;                              
## [103] &quot;island&quot;                                   
## [104] &quot;islandGroup&quot;                              
## [105] &quot;ISO2&quot;                                     
## [106] &quot;iucnRedListCategory&quot;                      
## [107] &quot;key&quot;                                      
## [108] &quot;kingdom&quot;                                  
## [109] &quot;kingdomKey&quot;                               
## [110] &quot;language&quot;                                 
## [111] &quot;lastCrawled&quot;                              
## [112] &quot;lastInterpreted&quot;                          
## [113] &quot;lastParsed&quot;                               
## [114] &quot;lat&quot;                                      
## [115] &quot;latestAgeOrHighestStage&quot;                  
## [116] &quot;latestEonOrHighestEonothem&quot;               
## [117] &quot;latestEpochOrHighestSeries&quot;               
## [118] &quot;latestEraOrHighestErathem&quot;                
## [119] &quot;latestPeriodOrHighestSystem&quot;              
## [120] &quot;license&quot;                                  
## [121] &quot;lifeStage&quot;                                
## [122] &quot;lithostratigraphicTerms&quot;                  
## [123] &quot;locality&quot;                                 
## [124] &quot;locationAccordingTo&quot;                      
## [125] &quot;locationID&quot;                               
## [126] &quot;locationRemarks&quot;                          
## [127] &quot;lon&quot;                                      
## [128] &quot;lowestBiostratigraphicZone&quot;               
## [129] &quot;materialSampleID&quot;                         
## [130] &quot;member&quot;                                   
## [131] &quot;modified&quot;                                 
## [132] &quot;month&quot;                                    
## [133] &quot;municipality&quot;                             
## [134] &quot;nameAccordingTo&quot;                          
## [135] &quot;namePublishedIn&quot;                          
## [136] &quot;namePublishedInYear&quot;                      
## [137] &quot;nomenclaturalCode&quot;                        
## [138] &quot;occurrenceID&quot;                             
## [139] &quot;occurrenceRemarks&quot;                        
## [140] &quot;occurrenceStatus&quot;                         
## [141] &quot;order&quot;                                    
## [142] &quot;orderKey&quot;                                 
## [143] &quot;organismID&quot;                               
## [144] &quot;organismQuantity&quot;                         
## [145] &quot;organismQuantityType&quot;                     
## [146] &quot;organismRemarks&quot;                          
## [147] &quot;originalNameUsage&quot;                        
## [148] &quot;otherCatalogNumbers&quot;                      
## [149] &quot;ownerInstitutionCode&quot;                     
## [150] &quot;parentEventID&quot;                            
## [151] &quot;parentNameUsage&quot;                          
## [152] &quot;phylum&quot;                                   
## [153] &quot;phylumKey&quot;                                
## [154] &quot;preparations&quot;                             
## [155] &quot;previousIdentifications&quot;                  
## [156] &quot;programmeAcronym&quot;                         
## [157] &quot;projectId&quot;                                
## [158] &quot;protocol&quot;                                 
## [159] &quot;publishingCountry&quot;                        
## [160] &quot;publishingOrgKey&quot;                         
## [161] &quot;recordedBy&quot;                               
## [162] &quot;recordNumber&quot;                             
## [163] &quot;references&quot;                               
## [164] &quot;reproductiveCondition&quot;                    
## [165] &quot;rights&quot;                                   
## [166] &quot;rightsHolder&quot;                             
## [167] &quot;sampleSizeUnit&quot;                           
## [168] &quot;sampleSizeValue&quot;                          
## [169] &quot;samplingEffort&quot;                           
## [170] &quot;samplingProtocol&quot;                         
## [171] &quot;scientificName&quot;                           
## [172] &quot;scientificNameID&quot;                         
## [173] &quot;sex&quot;                                      
## [174] &quot;species&quot;                                  
## [175] &quot;speciesKey&quot;                               
## [176] &quot;specificEpithet&quot;                          
## [177] &quot;startDayOfYear&quot;                           
## [178] &quot;taxonConceptID&quot;                           
## [179] &quot;taxonID&quot;                                  
## [180] &quot;taxonKey&quot;                                 
## [181] &quot;taxonomicStatus&quot;                          
## [182] &quot;taxonRank&quot;                                
## [183] &quot;taxonRemarks&quot;                             
## [184] &quot;type&quot;                                     
## [185] &quot;typeStatus&quot;                               
## [186] &quot;typifiedName&quot;                             
## [187] &quot;verbatimCoordinateSystem&quot;                 
## [188] &quot;verbatimElevation&quot;                        
## [189] &quot;verbatimEventDate&quot;                        
## [190] &quot;verbatimIdentification&quot;                   
## [191] &quot;verbatimLabel&quot;                            
## [192] &quot;verbatimLocality&quot;                         
## [193] &quot;verbatimSRS&quot;                              
## [194] &quot;verbatimTaxonRank&quot;                        
## [195] &quot;vernacularName&quot;                           
## [196] &quot;waterBody&quot;                                
## [197] &quot;year&quot;                                     
## [198] &quot;downloadDate&quot;</code></pre>
<pre class="r"><code># remove NA values if they exist in lat or lon
puma1&lt;-subset(puma.gbif, puma.gbif$lat != &quot;NA&quot;,)
puma1&lt;-subset(puma1, puma1$lon != &quot;NA&quot;,)
dim(puma.gbif)</code></pre>
<pre><code>## [1] 17038   198</code></pre>
<pre class="r"><code>dim(puma1)</code></pre>
<pre><code>## [1] 10217   198</code></pre>
<pre class="r"><code># So really only 10217 of the 17038 records are georeferenced.

# puma.gbif is just a dataframe. We need it to become spatial.
# This defines the CRS for the US in WGS 1984 (world geographic 1984). 
wgs1984.proj &lt;- CRS(&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs&quot;)

# Reference the columns with &quot;lon&quot; and &quot;lat&quot; to make a spatial points dataframe
puma &lt;- SpatialPoints(coords=puma1[,c(114,127)], proj4string=wgs1984.proj)

# Occasionally the GBIF data are updated and column order changes. Instead of 
# referencing the column number, it&#39;s better to call it out by name:
puma &lt;- SpatialPoints(coords=puma1[,c(&quot;lon&quot;,&quot;lat&quot;)], proj4string=wgs1984.proj)

# Reproject puma to Albers Equal Area Projection so it matches
# the Conterminous US Map
puma.equal &lt;- spTransform(puma, us.atlas.proj)
plot(us.equal, main=&quot;Puma concolor observations&quot;)
points(puma.equal, pch=19, cex=0.3, col=&quot;blue&quot;)</code></pre>
<p><img src="lab2_scale_files/figure-html/unnamed-chunk-8-2.png" width="672" /></p>
<pre class="r"><code>### CREATE AN EMPTY GRID - this will define the extent of the study area
# what are the units of us.equal?
summary(us.equal) </code></pre>
<pre><code>## Object of class SpatialPolygonsDataFrame
## Coordinates:
##        min     max
## x -5761986 3663387
## y -2361733 3911163
## Is projected: TRUE 
## proj4string :
## [+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +ellps=sphere +units=m
## +no_defs]
## Data attributes:
##    AFFGEOID            GEOID               NAME          
##  Length:1           Length:1           Length:1          
##  Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character</code></pre>
<pre class="r"><code># units = m
r &lt;- raster(us.equal)
# resolution (grain size in units of us.equal = meters)
res(r) &lt;- 50000     
r[] &lt;- rnorm(ncell(r))
plot(r)
plot(us.equal, add=T)</code></pre>
<p><img src="lab2_scale_files/figure-html/unnamed-chunk-8-3.png" width="672" /></p>
<pre class="r"><code>r[] &lt;- 0

### RASTERIZING (fitting data into a grid)
# rasterizing US boundary
us.raster &lt;- rasterize(us.equal, r, getCover=TRUE)
# assign the value in the US Raster to 1 value
us.raster[us.raster&gt;=1] &lt;- 1
us.raster[us.raster==0] &lt;- NA
plot(us.raster)</code></pre>
<p><img src="lab2_scale_files/figure-html/unnamed-chunk-8-4.png" width="672" /></p>
<pre class="r"><code># Plot the US outline shapefile
plot(us.equal)
# rasterizing the point data on puma concolor
puma.raster &lt;- rasterize(puma.equal, r)
puma.raster[puma.raster&gt;=1] &lt;- 1
puma.raster[puma.raster==0] &lt;- NA

# limiting the puma point data only to US
puma.raster &lt;- puma.raster*us.raster

plot(puma.raster, add=T, col=&#39;red&#39;)</code></pre>
<p><img src="lab2_scale_files/figure-html/unnamed-chunk-8-5.png" width="672" /></p>
<pre class="r"><code>### AGGREGATE TO COARSE GRAIN - puma occurrences
par(mfrow=c(2,2), mai=c(0.1, 0.1, 0.5, 0.1)) # 2x2 plots with margins

# 50 x 50 resolution
plot(puma.raster, axes=FALSE, col=&#39;red&#39;,
     legend=FALSE, main=&quot;50 km x 50 km&quot;)
plot(us.equal, add=T)

# 100 x 100 resolution
p.coarser &lt;- aggregate(puma.raster, fact=2, fun=max)
plot(p.coarser, axes=FALSE, col=&#39;red&#39;,
     legend=FALSE, main=&quot;100 km x 100 km&quot;)
plot(us.equal, add=T)

# 200 x 200 resolution
p.coarser2 &lt;- aggregate(p.coarser, fact=2, fun=max)
plot(p.coarser2, axes=FALSE, col=&#39;red&#39;,
     legend=FALSE, main=&quot;200 km x 200 km&quot;)
plot(us.equal, add=T)

#400 x 400 resolution
p.coarser4 &lt;- aggregate(p.coarser2, fact=2, fun=max)
plot(p.coarser4, axes=FALSE, col=&#39;red&#39;,
     legend=FALSE, main=&quot;400 km x 400 km&quot;)
plot(us.equal, add=T)</code></pre>
<p><img src="lab2_scale_files/figure-html/unnamed-chunk-8-6.png" width="672" /></p>
<pre class="r"><code>### Save your Workspace ###
## If you want to save your workspace and all the R objects within it:
save.image(file.path(output_path,&quot;lab2.RData&quot;))</code></pre>
</div>
</div>
<div
id="assignment---hand-in-a-r-markdown-produced-pdf-to-d2l-including-the-following"
class="section level2">
<h2>ASSIGNMENT - Hand in a R Markdown-produced PDF to D2L including the
following:</h2>
<ol style="list-style-type: decimal">
<li>Repeat the process above, but create 2 side-by-side plots for 2 new
resolutions of your choice. Create both of the plots at the extent of
the US Northeast (or if you use another species and it’s not in the
Northeast, clip it to another US region). Clip the rasters so they only
plot for the extent of the Northeast (or another region depending on the
species you choose).</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li><p>ADD A SCALEBAR: See these potential approaches: scalebar.R: <a
href="https://rdrr.io/cran/raster/src/R/scalebar.R"
class="uri">https://rdrr.io/cran/raster/src/R/scalebar.R</a> and <a
href="https://rdrr.io/cran/raster/man/scalebar.html"
class="uri">https://rdrr.io/cran/raster/man/scalebar.html</a>. Or: <a
href="https://www.rdocumentation.org/packages/raster/versions/2.6-7/topics/scalebar"
class="uri">https://www.rdocumentation.org/packages/raster/versions/2.6-7/topics/scalebar</a>
hint: look at the units (and extent) of a raster by typing the name of
the raster at the R prompt.</p></li>
<li><p>ADD A NORTH ARROW: hint: <a
href="https://www.rdocumentation.org/packages/GISTools/versions/0.7-4/topics/North%20Arrow"
class="uri">https://www.rdocumentation.org/packages/GISTools/versions/0.7-4/topics/North%20Arrow</a>
- this relies on the R package, GISTools.</p></li>
<li><p>CHANGE COLORS: Make each one of the plots differ in color for
pixels of the species occurrence raster.</p></li>
<li><p>OVERLAY the species occurrence points on one of your plotted
maps. Use a contrasting color for the points.</p></li>
<li><p>ADD A LEGEND. hint: <a
href="https://biologyforfun.wordpress.com/2013/03/11/taking-control-of-the-legend-in-raster-in-r/"
class="uri">https://biologyforfun.wordpress.com/2013/03/11/taking-control-of-the-legend-in-raster-in-r/</a>
Some tips on plotting LEGENDS with rasters (“distribution” below) and
shapefiles (“occurrence” below) together. “left” tells R where to put
the legend (lower left). You can also specify actual coordinates. pch is
the base R code for the point shape: <a
href="http://www.statmethods.net/advgraphs/parameters.html"
class="uri">http://www.statmethods.net/advgraphs/parameters.html</a> -
here it’s referencing 21 and 15 which are the circles and squares for
“occurrence” and “distribution” respectively. Assign their colors with
the “col=” command, and their size with “pt.cex”. Adding a title to the
legend is important, otherwise we don’t know what we’re looking at.
?legend will tell you more.</p></li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li><p>Repeat 1a-e. above, but this time reproject the data into another
projection for North America (your choice).</p></li>
<li><p>Briefly answer the following: How do the different projections
and resolutions change your interpretation of the distribution of the
species? Keep in mind that distribution does not just include extent or
range size. What would be an appropriate resolution and extent of
occurrence data for the species you chose if you are trying to represent
its full distribution? Which type of Coordinate System (projected or
geographic), if any, would be more appropriate to use with these data if
you wanted to measure distances between a) two extreme ends of the
species range? and b) two nearby species occurrences locations?</p></li>
</ol>
<p>Here are some useful bits of code:</p>
<pre class="r"><code># Regions of US shapefile
download.file(&quot;http://www2.census.gov/geo/tiger/GENZ2021/shp/cb_2021_us_region_20m.zip&quot;,
              dest=file.path(data_path,&quot;usr.zip&quot;), mode=&quot;wb&quot;) 
unzip( file.path(data_path,&quot;usr.zip&quot;), exdir = data_path)

# read in the US Regions shapefile
usr &lt;- readOGR(file.path(data_path,&quot;cb_2021_us_region_20m.shp&quot;))
## take a look at the shapefile info
summary(usr)
## follow the steps above for projecting it to WGS 1984, then to US National Atlas Equal-Area.
## Hint for plotting region: extract a portion of a shapefile and create a new one. 
## Look at the first 6 lines of data in the shapefile attribute table (you need to create usr.equal first).
# head(usr.equal) 
## make a shapefile of just Northeast
# ne &lt;- usr.equal[usr.equal$NAME ==&quot;Northeast&quot;,] </code></pre>
</div>
<div id="homework-in-preparation-for-lab-3" class="section level2">
<h2>Homework in preparation for Lab 3:</h2>
<p>In Lab 3 we will be working with landcover data from the National
Land Cover Database (NLCD). Read about NLCD here (<a
href="https://www.mrlc.gov/" class="uri">https://www.mrlc.gov/</a>) and
view the short video: <a href="https://www.mrlc.gov/nlcd-2016-video"
class="uri">https://www.mrlc.gov/nlcd-2016-video</a>.</p>
<p><strong>OPTIONAL MSU HPCC info:</strong> In past years we have used
the MSU HPCC for this lab, but we will not be doing so this year. We
will be using a smaller chunk of the data so you can run it on your
computer.</p>
<p>If you’re interested in learning about the HPCC here is the HPCC
website: <a href="https://docs.icer.msu.edu"
class="uri">https://docs.icer.msu.edu</a> and training workshops and
courses: <a
href="https://docs.icer.msu.edu/#hpcc-workshops-and-training"
class="uri">https://docs.icer.msu.edu/#hpcc-workshops-and-training</a></p>
<p>If you are not familiar with basic Linux commands, check out the HPCC
Intro to Linux online courses at the link above (now on D2L). You can
also check them out here: <a
href="https://linuxconfig.org/bash-scripting-tutorial-for-beginners#h1-bash-shell-scripting-definition"
class="uri">https://linuxconfig.org/bash-scripting-tutorial-for-beginners#h1-bash-shell-scripting-definition</a>.</p>
<p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This
work is licensed under a
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Licensed
under CC-BY 4.0 2020, 2022 by Phoebe Zarnetske</a>.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
